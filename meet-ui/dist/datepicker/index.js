const DAY=function(){const t=new Array(31);for(let e=0;e<t.length;e++)e<9?t[e]={label:e+1+"日",value:"0"+(e+1)}:t[e]={label:e+1+"日",value:e+1};return t}();Component({properties:{type:{type:String,value:"datetime"},trigger:{type:String,value:"field"},title:{type:String,value:"请选择"},placeholder:{type:String,value:"请选择"},value:{type:String,value:""},minuteGap:{type:Number,value:1},minYear:{type:Number,value:(new Date).getFullYear()-5},maxYear:{type:Number,value:(new Date).getFullYear()+5},bgColor:{type:String,value:"#fff"}},data:{items:[[]],selectedIndex:[],leapYear:!1,selectedText:""},observers:{type(e){let t=new Date,a="";var i=this.data.value;if(this.data.value){if(isNaN(new Date(i)))return;var s=new Date(i).getFullYear(),l=this.data["minYear"];this.setData({minYear:s<l?s:l}),t=new Date(i)}if("time"===e){s=this.getTimeDate();this.setData({items:s})}else if("year-month"===e){var l=this.getYearMonthDate(),s=t.getFullYear()-this.data.minYear,n=t.getMonth();const c=[];a=i?t.getFullYear()+`年${n+1}月`:"",c.push(s,n),this.setData({items:l,selectedIndex:c,selectedText:a})}else if("date"===e){var s=this.getYearMonthDayDate(),n=t.getFullYear()-this.data.minYear,l=t.getMonth(),r=t.getDate()-1;const m=[];var h=l<9?"0"+(l+1):l+1,d=r<9?"0"+(1+r):1+r;a=i?t.getFullYear()+`-${h}-`+d:"",m.push(n,l,r),this.setData({items:s,selectedIndex:m,selectedText:a})}else if("datetime"===e){h=this.getDateTimeDate(),d=t.getFullYear()-this.data.minYear,n=t.getMonth(),l=t.getDate()-1,r=t.getHours(),s=t.getMinutes();const p=[];var e=n<9?"0"+(n+1):n+1,u=l<9?"0"+(1+l):1+l,g=r<10?"0"+r:r,o=s<10?"0"+s:s;a=i?t.getFullYear()+`-${e}-${u} ${g}:`+o:"",p.push(d,n,l,r,s),this.setData({items:h,selectedIndex:p,selectedText:a})}}},methods:{getPicker(){if(!this.picker){this.picker=this.selectComponent(".mt-datepicker");const t=this["picker"],a=t["setColumnItems"];t.setColumnItems=(...e)=>a.apply(t,[...e,!1])}return this.picker},getTimeDate(){var t=this.data["minuteGap"];const a=new Array(24),i=[];for(let e=0;e<60;e++)e%t==0&&(e<10?i.push({label:`0${e}分`,value:"0"+e}):i.push({label:e+"分",value:e}));for(let e=0;e<a.length;e++)e<10?a[e]={label:`0${e}时`,value:"0"+e}:a[e]={label:e+"时",value:e};return[a,i]},getYearMonthDate(){var{maxYear:t,minYear:a}=this.data;const i=new Array(12),s=[];for(let e=0;e<12;e++)e<9?i[e]={label:e+1+"月",value:"0"+(e+1)}:i[e]={label:e+1+"月",value:e+1};for(let e=a;e<=t;e++)s.push({label:e+"年",value:e});return[s,i]},getYearMonthDayDate(){const e=this.getYearMonthDate();var t=(new Date).getMonth()+1,a=(new Date).getFullYear();const i=DAY.concat();let s=[];const l=[4,6,9,11];return s=this.judgeLeapYear(a)&&2===t?(this.setData({leapYear:this.judgeLeapYear(a)}),i.splice(0,i.length-2)):-1<l.indexOf(t)&&2===t?i.splice(0,i.length-3):-1<l.indexOf(t)&&2!==t?i.splice(0,i.length-1):i,e.push(s),e},getDateTimeDate(){var e=this.getYearMonthDayDate(),t=this.getTimeDate();return[...e,...t]},changeTime(e,t){var a,{selectedIndex:i,minYear:s}=this.data,l=i[0]+s,n=i[1]+1,r=i[2]+1;0===e?(a=this.judgeLeapYear(t),1===i[1]&&this.judgeDate(e,l,t,r),this.setData({[`selectedIndex[${e}]`]:t-s,leapYear:a})):1===e?(this.judgeDate(e,n,t,r),this.setData({[`selectedIndex[${e}]`]:t-1})):2===e?this.setData({[`selectedIndex[${e}]`]:t-1}):this.setData({[`selectedIndex[${e}]`]:t})},judgeDate(e,t,a,i){const s=[1,3,5,7,8,10,12],l=[2,4,6,9,11],n=DAY.concat();let r=[],h="";var d=this.data["leapYear"];const u=this.getPicker();if(0===e&&this.judgeLeapYear(t)!==this.judgeLeapYear(a))r=this.judgeLeapYear(t)?n.splice(0,n.length-3):n.splice(0,n.length-2),h=i>r.length?r.length:i,u.setColumnItems(2,r,!1),this.setData({"selectedIndex[2]":h-1});else if(1===e&&!(-1<s.indexOf(t)&&-1<s.indexOf(a)))if(-1<l.indexOf(t)&&-1<l.indexOf(a)){if(2===t)r=n.splice(0,n.length-1);else{if(2!==a)return;r=n.splice(0,d?n.length-2:n.length-3)}h=i>r.length?r.length:i,u.setColumnItems(2,r,!1),this.setData({"selectedIndex[2]":h-1})}else-1<l.indexOf(a)?(r=2===a?n.splice(0,d?n.length-2:n.length-3):n.splice(0,n.length-1),h=i>r.length?r.length:i,u.setColumnItems(2,r,!1),this.setData({"selectedIndex[2]":h-1})):-1<s.indexOf(a)&&u.setColumnItems(2,n,!1)},judgeLeapYear(e){return e%4==0&&e%100!=0||e%400==0},onChange(e){var{columnIndex:e,item:t,index:a}=e.detail,i=this.data["type"];"datetime"!==i&&"date"!==i||this.changeTime(e,+t[e].value),this.triggerEvent("change",{columnIndex:e,index:a,item:t})},onConfirm(e){var t=this.data["type"],a=e.detail["value"],a=this.formatDate(a,t);this.setData({selectedText:a}),this.triggerEvent("confirm",{formatValue:a,...e.detail})},formatDate(e,t){const a=[];let i="";return"datetime"===t||"time"===t||"date"===t?e.map(e=>{a.push(e.value)}):e.map(e=>{a.push(e.label)}),i="datetime"===t?a.slice(0,3).join("-")+" "+a.slice(3,5).join(":"):"time"===t?a.join(":"):"date"===t?a.join("-"):a.join("")},setVisible(){const e=this.getPicker();e.setVisible()}}});