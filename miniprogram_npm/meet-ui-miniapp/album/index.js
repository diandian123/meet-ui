import Util from"../utils/util";Component({options:{addGlobalClass:!0},properties:{width:{type:Number,value:678},items:{type:Array,value:[]},column:{type:Number,value:3},rowGap:{type:Number,value:3},columnGap:{type:Number,value:3},hasPreview:{type:Boolean,value:!0},lazyLoad:{type:Boolean,value:!0},imageMode:{type:String,value:"aspectFill"},imageRadius:{type:Number,value:12},maxCount:{type:Number,value:-1},errorImage:{type:String,value:"./images/default.png"}},data:{imageWidth:"auto",imageHeight:"auto",showUrls:[]},observers:{items(e){var t=this.data.maxCount,a=Util.rpx2px(this.data.width);e&&(1===e.length||1===t?this.getSingleImageInfo(a):(a=(a-2*this.data.rowGap)/3+"px",this.setData({imageWidth:a,imageHeight:a}))),0<t&&this.setData({showUrls:e.slice(0,t)})}},methods:{getAlbumWidth(){return new Promise(t=>{const e=this.createSelectorQuery();e.select(".mt-album").boundingClientRect(e=>{t(e)}).exec()})},previewImage(e){if(this.data.hasPreview){e=e.currentTarget.dataset["index"];const t=this.data.items,a=[];t.forEach(e=>{a.push(e.prevUrl||e.url)}),wx.previewImage({current:t[e].prevUrl||t[e].url,urls:a}),this.triggerEvent("preview",{index:e})}},imageError(e){const{items:t,maxCount:a,errorImage:i}=this.data;e=e.currentTarget.dataset.imgindex;t[e].url=i,t[e].prevUrl=i,this.setData({items:t}),0<a&&this.setData({showUrls:t.slice(0,a)})},handleMore(){this.triggerEvent("more")},getSingleImageInfo(t){var e=this.data.items[0],a=this.data.items[0].url;const i=this.data.rowGap;e.width&&e.height?(e=e.width/e.height,this.singleDisplayRule(t,i,e)):wx.getImageInfo({src:a,success:e=>{e=e.width/e.height;this.singleDisplayRule(t,i,e)}})},singleDisplayRule(e,t,a){var i,t=(e-2*t)/3*2+t;a<1/3?this.setData({imageWidth:t/3+"px",imageHeight:t+"px"}):1/3<=a&&a<.75?(i=Math.min(Math.floor(t/a),4*t/3),this.setData({imageWidth:t+"px",imageHeight:i+"px"})):1.25<a&&a<=3?(i=Math.min(Math.floor(e/a),9*e/16),this.setData({imageWidth:e+"px",imageHeight:i+"px"})):.75<=a<=1.25?this.setData({imageWidth:t+"px",imageHeight:t/a+"px"}):3<a&&this.setData({imageWidth:t+"px",imageHeight:t/3+"px"})},getFourImageInfo(){const e=this.createSelectorQuery();e.select(".mt-album").boundingClientRect(e=>{e=""+(e.width-this.data.rowGap)/2;this.setData({imageWidth:e+"px",imageHeight:3*e/4+"px",column:2})}).exec()}}});